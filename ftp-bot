#!/bin/bash

# FTP Bot Script for Telegram

# Parse arguments
while [[ "$#" -gt 0 ]]; do
    case $1 in
        --token) token="$2"; shift ;;
        --chat_id) chat_id="$2"; shift ;;
        *) echo "Unknown parameter passed: $1"; exit 1 ;;
    esac
    shift
done

# Function to send message to Telegram
send_message() {
    local message="$1"
    curl -s -X POST https://api.telegram.org/bot$token/sendMessage -d chat_id=$chat_id -d text="$message" >/dev/null
}

# Function to add a new virtual host
add_virtual_host() {
    local domain_name="$1"
    local php_version="$2"
    
    # Your logic to add virtual host here
    
    send_message "Virtual host $domain_name created successfully with PHP $php_version."
}

# Function to remove a virtual host
remove_virtual_host() {
    local domain_name="$1"
    
    # Your logic to remove virtual host here
    
    send_message "Virtual host $domain_name removed successfully."
}

# Main Script
echo "FTP Bot Script for Telegram"

# Check if token and chat_id are provided
if [ -z "$token" ] || [ -z "$chat_id" ]; then
    echo "Telegram Bot token or Chat ID not provided. Exiting."
    exit 1
fi

# Listen for Telegram messages
while true; do
    message=$(curl -s "https://api.telegram.org/bot$token/getUpdates" | jq -r '.result[-1].message.text')

    case "$message" in
        "/add_vhost "*)
            domain_name=$(echo "$message" | cut -d ' ' -f 2)
            php_version=$(echo "$message" | cut -d ' ' -f 3)
            add_virtual_host "$domain_name" "$php_version"
            ;;
        "/remove_vhost "*)
            domain_name=$(echo "$message" | cut -d ' ' -f 2)
            remove_virtual_host "$domain_name"
            ;;
        "/help")
            send_message "Available commands:
            /add_vhost <domain_name> <php_version> - Add a new virtual host.
            /remove_vhost <domain_name> - Remove an existing virtual host.
            /help - Show this help message."
            ;;
        *)
            send_message "Unknown command. Type /help for available commands."
            ;;
    esac
done
